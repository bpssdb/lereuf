---
title: "Readme"
output: html_document
---

# üöÄ Int√©gration du Parseur Excel v3 dans BudgiBot

## üìã Fichiers modifi√©s/cr√©√©s

### 1. **Nouveau parseur optimis√©**
- `modules/parseur_excel/parseur_excel_v3.R` - Parseur principal optimis√©
- Remplace progressivement `parseur_excel.R`

### 2. **Module mis √† jour**
- `modules/mod_mesures_cat_combo_v3.R` - Module Excel avec parseur v3
- Remplace `mod_mesures_cat_combo.R`

### 3. **Configuration globale**
- `global_chatbot_v3.R` - Configuration mise √† jour
- Remplace `global_chatbot.R`

### 4. **Application principale**
- `app_v3.R` - Point d'entr√©e mis √† jour
- Remplace `app.R`

## üîß Instructions d'installation

### √âtape 1: Sauvegarder les fichiers existants
```bash
# Sauvegarder l'ancienne version
cp global_chatbot.R global_chatbot_backup.R
cp modules/mod_mesures_cat_combo.R modules/mod_mesures_cat_combo_backup.R
cp app.R app_backup.R
```

### √âtape 2: Installer les nouveaux fichiers
```bash
# Copier les nouveaux fichiers
cp global_chatbot_v3.R global_chatbot.R
cp modules/mod_mesures_cat_combo_v3.R modules/mod_mesures_cat_combo.R
cp app_v3.R app.R

# Ajouter le nouveau parseur
cp modules/parseur_excel/parseur_excel_v3.R modules/parseur_excel/
```

### √âtape 3: Installer les d√©pendances (si n√©cessaire)
```r
# Nouvelles d√©pendances pour la parall√©lisation
install.packages(c("future", "future.apply", "digest"))
```

## ‚öôÔ∏è Configuration

### Configuration par d√©faut
```r
options(
  budgibot.chunk_size = 800,      # Formules par chunk
  budgibot.max_memory = 1024,     # Limite m√©moire (MB)
  budgibot.workers = 6,           # Workers parall√®les
  budgibot.cache = TRUE,          # Cache activ√©
  budgibot.progress = TRUE        # Barres de progression
)
```

### Ajustement selon vos besoins
```r
# Pour serveurs puissants
options(
  budgibot.chunk_size = 1500,
  budgibot.max_memory = 2048,
  budgibot.workers = 12
)

# Pour serveurs limit√©s
options(
  budgibot.chunk_size = 400,
  budgibot.max_memory = 512,
  budgibot.workers = 2
)
```

## üéØ Nouvelles fonctionnalit√©s

### 1. **Interface enrichie**
- Bouton "üìä Stats parsing v3" : Affiche d√©tails du traitement
- Compteur de formules sur le bouton d'application
- Messages de progression d√©taill√©s

### 2. **Gestion d'erreur am√©lior√©e**
- Modal avec statistiques compl√®tes
- Tableau des formules non converties
- Informations de performance

### 3. **Cache intelligent**
- √âvite de reparser les fichiers identiques
- Nettoyage automatique des anciens caches
- Signature bas√©e sur contenu + date de modification

## üìä Performances attendues

| Taille fichier | Am√©lioration | Temps typique |
|---------------|--------------|---------------|
| < 5 MB        | 2-3x         | 10-30s        |
| 5-20 MB       | 3-8x         | 30s-2min     |
| 20-50 MB      | 5-15x        | 2-5min       |
| > 50 MB       | 10-20x       | 5-15min      |

## üîç Monitoring et debug

### V√©rifier la configuration
```r
# Dans la console R
getOption("budgibot.chunk_size")
getOption("budgibot.workers")
getOption("budgibot.cache")
```

### Logs de performance
Le parseur v3 affiche automatiquement :
- Nombre de formules trait√©es
- Temps de traitement
- Taux de succ√®s
- Configuration utilis√©e

### Nettoyage manuel du cache
```r
# Dans la console R
clean_budgibot_cache()
```

## üö® R√©solution de probl√®mes

### Erreur de m√©moire
```r
# R√©duire la taille des chunks
options(budgibot.chunk_size = 200)
options(budgibot.max_memory = 256)
```

### Performances lentes
```r
# Augmenter le parall√©lisme
options(budgibot.workers = min(8, parallel::detectCores() - 1))
```

### Erreurs de parsing
- V√©rifier le bouton "üìä Stats parsing v3"
- Consulter le tableau des erreurs
- Les formules complexes peuvent n√©cessiter des ajustements

## üîÑ Rollback vers l'ancienne version

Si n√©cessaire, restaurer l'ancienne version :
```bash
cp global_chatbot_backup.R global_chatbot.R
cp modules/mod_mesures_cat_combo_backup.R modules/mod_mesures_cat_combo.R
cp app_backup.R app.R
```

## üìà Prochaines am√©liorations

1. **Support √©tendu des fonctions Excel**
2. **Optimisations pour fichiers > 100 MB**
3. **Interface de configuration avanc